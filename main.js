/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var f=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var M=(d,e)=>{for(var a in e)f(d,a,{get:e[a],enumerable:!0})},b=(d,e,a,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of S(e))!E.call(d,t)&&t!==a&&f(d,t,{get:()=>e[t],enumerable:!(i=v(e,t))||i.enumerable});return d};var C=d=>b(f({},"__esModule",{value:!0}),d);var Y={};M(Y,{default:()=>g});module.exports=C(Y);var y=require("obsidian");var u=class{constructor(e,a,i,t){if(this.container=e,this.data=a,this.options=i,this.onUpdate=t,Object.keys(this.data.goals).length===0){let r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth()}else{let r=new URLSearchParams(window.location.hash.slice(1));this.currentYear=parseInt(r.get("year")||new Date().getFullYear().toString()),this.currentMonth=parseInt(r.get("month")||new Date().getMonth().toString())}}async updateGoal(e,a){this.data.goals[e]=!a,await this.onUpdate(this.data)}updateUrlParams(){let e=new URLSearchParams(window.location.hash.slice(1));e.set("year",this.currentYear.toString()),e.set("month",this.currentMonth.toString()),window.history.replaceState(null,"",`#${e.toString()}`)}navigateToDate(e,a){this.currentYear=e,a!==void 0&&(this.currentMonth=a),this.updateUrlParams(),this.render()}calculateStreak(){if(!this.options.showStreak)return 0;let e=Object.entries(this.data.goals).filter(([i,t])=>t).map(([i])=>i).sort();if(e.length===0)return 0;let a=new Date;if(a.setHours(0,0,0,0),this.options.type==="daily"){let i=e.map(n=>new Date(n)).sort((n,o)=>o.getTime()-n.getTime()),t=0,r=null;for(let n of i){if(n>a)continue;if(!r){t=1,r=n;continue}if(Math.round((r.getTime()-n.getTime())/(1e3*60*60*24))===1)t++,r=n;else break}return t}else if(this.options.type==="weekly"){let i=e.filter(n=>n.includes("-W")).sort((n,o)=>o.localeCompare(n)),t=0,r=null;for(let n of i){let[o,l]=n.split("-W").map(Number);if(!r){t=1,r=n;continue}let[s,c]=r.split("-W").map(Number);if(o===s&&l===c-1||o===s-1&&c===1&&l===52)t++,r=n;else break}return t}else if(this.options.type==="monthly"){let i=e.sort((n,o)=>o.localeCompare(n)),t=0,r=null;for(let n of i){let[o,l]=n.split("-").map(Number);if(!r){t=1,r=n;continue}let[s,c]=r.split("-").map(Number);if(o===s&&l===c-1||o===s-1&&c===1&&l===12)t++,r=n;else break}return t}return 0}renderStreakCounter(){if(!this.options.showStreak)return;let e=this.calculateStreak(),a=this.container.createEl("div",{cls:"goal-tracker-streak"}),i=this.options.type==="daily"?"day":this.options.type==="weekly"?"week":"month";a.createEl("span",{text:`Current streak: ${e} ${i}${e!==1?"s":""}`})}render(){switch(this.container.empty(),this.container.createEl("h3",{text:this.options.title,cls:"goal-tracker-title"}),this.renderStreakCounter(),this.renderCalendarControls(),this.options.type){case"monthly":this.renderMonthlyView();break;case"weekly":this.renderWeeklyView();break;case"daily":default:this.renderDailyView()}}renderMonthlyView(){let e=this.container.createEl("div",{cls:"goal-tracker-calendar monthly"});for(let a=0;a<12;a++){let i=(a+1).toString().padStart(2,"0"),t=`${this.currentYear}-${i}`,r=this.data.goals[t]??!1,n=e.createEl("div",{cls:`calendar-cell ${r?"completed":""}`,text:new Date(2024,a).toLocaleString("default",{month:"short"})});n.addEventListener("click",async()=>{this.data.goals[t]=!r,await this.onUpdate(this.data),n.toggleClass("completed",!r)})}}renderWeeklyView(){let e=this.container.createEl("div",{cls:"goal-tracker-calendar weekly"}),a=new Date(this.currentYear,this.currentMonth,1),i=new Date(this.currentYear,this.currentMonth+1,0),t=new Date(a),r=t.getDay();for(t.setDate(t.getDate()-(r===0?6:r-1));t<=i;){let n=new Date(t);n.setDate(n.getDate()+6);let o=this.getWeekNumber(t),l=this.getWeekYear(t),s=new Date(t);if(s.setDate(s.getDate()+3),s.getMonth()===this.currentMonth&&s.getFullYear()===this.currentYear){let h=e.createEl("div",{cls:"week-row"}),p=`${l}-W${o}`,m=this.data.goals[p]??!1,D=`${t.getDate()} ${t.toLocaleString("default",{month:"short"})} - ${n.getDate()} ${n.toLocaleString("default",{month:"short"})}`,k=h.createEl("div",{cls:"week-info"});k.createEl("span",{text:`Week ${o}`,cls:"week-number"}),k.createEl("span",{text:D,cls:"week-dates"});let w=h.createEl("div",{cls:`calendar-cell ${m?"completed":""}`});w.addEventListener("click",async()=>{this.data.goals[p]=!m,await this.onUpdate(this.data),w.toggleClass("completed",!m)})}t.setDate(t.getDate()+7)}}renderDailyView(){let e=this.container.createEl("div",{cls:"goal-tracker-calendar"}),a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=e.createEl("div",{cls:"calendar-row"});a.forEach(s=>{i.createEl("div",{cls:"calendar-cell header",text:s})});let t=new Date(this.currentYear,this.currentMonth,1),n=new Date(this.currentYear,this.currentMonth+1,0).getDate(),o=t.getDay(),l=e.createEl("div",{cls:"calendar-row"});for(let s=0;s<o;s++)l.createEl("div",{cls:"calendar-cell empty"});for(let s=1;s<=n;s++){(s+o-1)%7===0&&s!==1&&(l=e.createEl("div",{cls:"calendar-row"}));let c=`${this.currentYear}-${(this.currentMonth+1).toString().padStart(2,"0")}-${s.toString().padStart(2,"0")}`,h=this.data.goals[c]??!1,p=l.createEl("div",{cls:`calendar-cell ${h?"completed":""}`,text:s.toString()});p.addEventListener("click",async()=>{this.data.goals[c]=!h,await this.onUpdate(this.data),p.toggleClass("completed",!h)})}}getWeekYear(e){let a=new Date(e);return a.setDate(a.getDate()+3-(a.getDay()+6)%7),a.getFullYear()}getWeekNumber(e){let a=new Date(e.valueOf()),i=(e.getDay()+6)%7;a.setDate(a.getDate()-i+3);let t=a.valueOf();return a.setMonth(0,1),a.getDay()!==4&&a.setMonth(0,1+(4-a.getDay()+7)%7),1+Math.ceil((t-a.valueOf())/6048e5)}renderCalendarControls(){let e=this.container.createEl("div",{cls:"goal-tracker-controls"}),a=e.createEl("button",{text:"←"}),i=e.createEl("span",{text:this.currentYear.toString(),cls:"year-display"}),t=e.createEl("button",{text:"→"});if(this.options.type==="monthly"){a.addEventListener("click",()=>{this.navigateToDate(this.currentYear-1)}),t.addEventListener("click",()=>{this.navigateToDate(this.currentYear+1)});return}let r=e.createEl("select");["January","February","March","April","May","June","July","August","September","October","November","December"].forEach((o,l)=>{let s=r.createEl("option",{text:o,value:l.toString()});l===this.currentMonth&&(s.selected=!0)}),r.addEventListener("change",o=>{this.navigateToDate(this.currentYear,parseInt(o.target.value))}),a.addEventListener("click",()=>{this.currentMonth===0?this.navigateToDate(this.currentYear-1,11):this.navigateToDate(this.currentYear,this.currentMonth-1),r.value=this.currentMonth.toString()}),t.addEventListener("click",()=>{this.currentMonth===11?this.navigateToDate(this.currentYear+1,0):this.navigateToDate(this.currentYear,this.currentMonth+1),r.value=this.currentMonth.toString()})}};var g=class extends y.Plugin{async onload(){this.registerMarkdownCodeBlockProcessor("goal-calendar",async(e,a,i)=>{let t;this.options={type:"daily",title:"Goal tracker",showStreak:!1};try{let n=e.trim().split(`
`);for(;n.length>0&&n[0].includes(":");){let[l,s]=n[0].split(":"),c=l.trim(),h=s.trim();c==="type"?this.options.type=h:c==="title"?this.options.title=h:c==="streak"&&(this.options.showStreak=h.toLowerCase()==="on"),n.shift()}let o=n.join(`
`);o.trim()?t=JSON.parse(o):t={id:crypto.randomUUID(),type:this.options.type,title:this.options.title,goals:{}},t.title=this.options.title}catch(n){console.error("Failed to parse calendar data",n),t={id:crypto.randomUUID(),type:this.options.type,title:this.options.title,goals:{}}}new u(a,t,this.options,async n=>{let o=this.app.vault.getAbstractFileByPath(i.sourcePath);if(!(o instanceof y.TFile)){console.error("Could not find source file");return}await this.app.vault.process(o,l=>{let s=i.getSectionInfo(a);return s?this.updateCalendarBlock(l,s,n):(console.error("Could not find section info"),l)})}).render()})}updateCalendarBlock(e,a,i){let t=e.split(`
`),r=a.lineStart,n=a.lineEnd,o=t.slice(0,r+1).join(`
`),l=t.slice(n).join(`
`),s=[`type: ${this.options.type}`,`title: ${this.options.title}`,this.options.showStreak?"streak: on":null].filter(Boolean).join(`
`);return`${o}
${s}
${JSON.stringify(i,null,2)}
${l}`}};
